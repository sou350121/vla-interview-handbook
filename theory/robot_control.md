# æœºæ¢°è‡‚è¿åŠ¨å­¦ã€åŠ¨åŠ›å­¦ä¸æ§åˆ¶ (Robot Arm Kinematics, Dynamics & Control)

> **é¢è¯•åœºæ™¯**: "ä»‹ç»ä¸€ä¸‹æœºæ¢°è‡‚çš„æ­£é€†è¿åŠ¨å­¦ï¼Œä»¥åŠå¸¸ç”¨çš„æ§åˆ¶æ–¹æ³•ï¼ˆPIDã€MPCã€é˜»æŠ—æ§åˆ¶ï¼‰çš„åŒºåˆ«ï¼Ÿ"

æœ¬æ–‡æ¶µç›–æœºæ¢°è‡‚çš„è¿åŠ¨å­¦å»ºæ¨¡ã€åŠ¨åŠ›å­¦å»ºæ¨¡ï¼Œä»¥åŠä¸»æµæ§åˆ¶æ–¹æ³•çš„åŸç†ä¸åº”ç”¨ã€‚

---

## ğŸ“Š æ§åˆ¶æ–¹æ³•å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœºæ¢°è‡‚æ§åˆ¶æ–¹æ³•åˆ†ç±»                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   æ§åˆ¶å±‚çº§              æ–¹æ³•                    ç‰¹ç‚¹                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                             â”‚
â”‚   å…³èŠ‚ç©ºé—´æ§åˆ¶          PID                    ç®€å•ã€å¿«é€Ÿã€æ— éœ€æ¨¡å‹          â”‚
â”‚   (Joint Space)        Computed Torque        åŸºäºåŠ¨åŠ›å­¦æ¨¡å‹                â”‚
â”‚                                                                             â”‚
â”‚   ç¬›å¡å°”ç©ºé—´æ§åˆ¶        ä½ç½®æ§åˆ¶               ç²¾ç¡®ä½ç½®è·Ÿè¸ª                  â”‚
â”‚   (Cartesian Space)    é€Ÿåº¦æ§åˆ¶               è½¨è¿¹è·Ÿè¸ª                      â”‚
â”‚                                                                             â”‚
â”‚   åŠ›/æŸ”é¡ºæ§åˆ¶           é˜»æŠ—æ§åˆ¶               å¼¹ç°§-é˜»å°¼è¡Œä¸º                 â”‚
â”‚   (Force/Compliance)   å¯¼çº³æ§åˆ¶               åŠ›è¾“å…¥â†’ä½ç½®è¾“å‡º               â”‚
â”‚                        æ··åˆåŠ›ä½æ§åˆ¶           ä¸åŒæ–¹å‘ä¸åŒæ§åˆ¶              â”‚
â”‚                                                                             â”‚
â”‚   æœ€ä¼˜æ§åˆ¶              MPC                    é¢„æµ‹+ä¼˜åŒ–ï¼Œå¤„ç†çº¦æŸ           â”‚
â”‚   (Optimal Control)    LQR                    çº¿æ€§ç³»ç»Ÿæœ€ä¼˜                  â”‚
â”‚                                                                             â”‚
â”‚   å­¦ä¹ å‹æ§åˆ¶            RL (PPO/SAC)           ç«¯åˆ°ç«¯ç­–ç•¥                    â”‚
â”‚   (Learning-based)     IL (BC)                æ¨¡ä»¿å­¦ä¹                       â”‚
â”‚                                                                             â”‚
â”‚   ğŸ’¡ VLA è¶‹åŠ¿: é«˜å±‚ç”¨ VLA è§„åˆ’åŠ¨ä½œ â†’ åº•å±‚ç”¨ä¼ ç»Ÿæ§åˆ¶æ‰§è¡Œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. è¿åŠ¨å­¦ (Kinematics)

### 1.1 æ­£è¿åŠ¨å­¦ (Forward Kinematics, FK)

**å®šä¹‰**: ç»™å®šå…³èŠ‚è§’åº¦ $\mathbf{q}$ï¼Œæ±‚æœ«ç«¯æ‰§è¡Œå™¨ä½å§¿ $\mathbf{T}_{ee}$ã€‚

$$
\mathbf{T}_{ee} = FK(\mathbf{q}) = \mathbf{T}_1(\theta_1) \cdot \mathbf{T}_2(\theta_2) \cdots \mathbf{T}_n(\theta_n)
$$

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ­£è¿åŠ¨å­¦ç¤ºæ„å›¾                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   å…³èŠ‚è§’åº¦                                         æœ«ç«¯ä½å§¿                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ Î¸â‚      â”‚                                    â”‚ x, y, z â”‚               â”‚
â”‚   â”‚ Î¸â‚‚      â”‚  â”€â”€â”€â”€â–º FK (DH å‚æ•°) â”€â”€â”€â”€â–º          â”‚ R (æ—‹è½¬)â”‚               â”‚
â”‚   â”‚ ...     â”‚                                    â”‚         â”‚               â”‚
â”‚   â”‚ Î¸â‚™      â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              â”‚
â”‚                                                                             â”‚
â”‚   DH å‚æ•° (Denavit-Hartenberg):                                            â”‚
â”‚   â€¢ a_i: è¿æ†é•¿åº¦ (æ²¿ x è½´)                                                 â”‚
â”‚   â€¢ Î±_i: è¿æ†æ‰­è½¬ (ç»• x è½´)                                                 â”‚
â”‚   â€¢ d_i: è¿æ†åè· (æ²¿ z è½´)                                                 â”‚
â”‚   â€¢ Î¸_i: å…³èŠ‚è§’åº¦ (ç»• z è½´)                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç å®ç°**:

```python
import numpy as np
from scipy.spatial.transform import Rotation as R

def dh_transform(theta, d, a, alpha):
    """å•ä¸ªå…³èŠ‚çš„ DH å˜æ¢çŸ©é˜µ"""
    ct, st = np.cos(theta), np.sin(theta)
    ca, sa = np.cos(alpha), np.sin(alpha)
    return np.array([
        [ct, -st*ca,  st*sa, a*ct],
        [st,  ct*ca, -ct*sa, a*st],
        [0,   sa,     ca,    d   ],
        [0,   0,      0,     1   ]
    ])

def forward_kinematics(joint_angles, dh_params):
    """
    æ­£è¿åŠ¨å­¦è®¡ç®—
    
    Args:
        joint_angles: å…³èŠ‚è§’åº¦ [Î¸â‚, Î¸â‚‚, ..., Î¸â‚™]
        dh_params: DH å‚æ•°è¡¨ [(d, a, Î±), ...]
    
    Returns:
        T_ee: æœ«ç«¯æ‰§è¡Œå™¨å˜æ¢çŸ©é˜µ (4x4)
    """
    T = np.eye(4)
    for i, (theta, (d, a, alpha)) in enumerate(zip(joint_angles, dh_params)):
        T = T @ dh_transform(theta, d, a, alpha)
    return T

# Franka Panda ç¤ºä¾‹ DH å‚æ•° (ç®€åŒ–)
franka_dh = [
    (0.333, 0,      0),       # Joint 1
    (0,     0,     -np.pi/2), # Joint 2
    (0.316, 0,      np.pi/2), # Joint 3
    (0,     0.0825, np.pi/2), # Joint 4
    (0.384, -0.0825,-np.pi/2),# Joint 5
    (0,     0,      np.pi/2), # Joint 6
    (0.107, 0.088,  np.pi/2), # Joint 7 (flange)
]

# è®¡ç®—æœ«ç«¯ä½å§¿
q = [0, -np.pi/4, 0, -3*np.pi/4, 0, np.pi/2, np.pi/4]
T_ee = forward_kinematics(q, franka_dh)
position = T_ee[:3, 3]
rotation = R.from_matrix(T_ee[:3, :3])
```

### 1.2 é€†è¿åŠ¨å­¦ (Inverse Kinematics, IK)

**å®šä¹‰**: ç»™å®šæœ«ç«¯æ‰§è¡Œå™¨ç›®æ ‡ä½å§¿ $\mathbf{T}_{target}$ï¼Œæ±‚å…³èŠ‚è§’åº¦ $\mathbf{q}$ã€‚

$$
\mathbf{q} = IK(\mathbf{T}_{target})
$$

**æ–¹æ³•å¯¹æ¯”**:

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- |
| **è§£æè§£** | ç²¾ç¡®ã€å¿«é€Ÿ | åªé€‚ç”¨äºç‰¹å®šæ„å‹ | 6 è½´å·¥ä¸šè‡‚ |
| **æ•°å€¼è¿­ä»£ (Jacobian)** | é€šç”¨ | å¯èƒ½ä¸æ”¶æ•› | é€šç”¨æœºæ¢°è‡‚ |
| **ä¼˜åŒ–æ–¹æ³•** | å¯åŠ çº¦æŸ | è¾ƒæ…¢ | å†—ä½™è‡‚ã€é¿éšœ |
| **å­¦ä¹ æ–¹æ³• (NN)** | å¿«é€Ÿ | éœ€è¦å¤§é‡æ•°æ® | å®æ—¶åº”ç”¨ |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€†è¿åŠ¨å­¦æ–¹æ³•å¯¹æ¯”                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   è§£æè§£ (Analytic):                                                        â”‚
â”‚   â€¢ å‡ ä½•æ–¹æ³•ï¼šåˆ©ç”¨è‡‚çš„å‡ ä½•å…³ç³»ç›´æ¥æ±‚è§£                                       â”‚
â”‚   â€¢ é€‚ç”¨äº 6 è‡ªç”±åº¦æ ‡å‡†æ„å‹ (å¦‚ UR, Panda)                                  â”‚
â”‚   â€¢ é€šå¸¸æœ‰å¤šè§£ (æœ€å¤š 8 ç»„)ï¼Œéœ€é€‰æ‹©æœ€ä¼˜è§£                                    â”‚
â”‚                                                                             â”‚
â”‚   æ•°å€¼è¿­ä»£ (Jacobian Pseudoinverse):                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Î”x = J(q) Â· Î”q                                                   â”‚   â”‚
â”‚   â”‚   Î”q = Jâº(q) Â· Î”x   (Jâº ä¸ºä¼ªé€†)                                    â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   è¿­ä»£: q_{k+1} = q_k + Î± Â· Jâº(q_k) Â· (x_target - FK(q_k))         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   ä¼˜åŒ–æ–¹æ³• (å¯åŠ çº¦æŸ):                                                      â”‚
â”‚   min_q  ||FK(q) - T_target||Â² + Î»||q - q_ref||Â²                          â”‚
â”‚   s.t.   q_min â‰¤ q â‰¤ q_max        (å…³èŠ‚é™ä½)                               â”‚
â”‚          ||qÌ‡|| â‰¤ v_max            (é€Ÿåº¦é™åˆ¶)                               â”‚
â”‚          é¿éšœçº¦æŸ                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°å€¼ IK å®ç°**:

```python
def jacobian_ik(target_pose, q_init, dh_params, max_iter=100, tol=1e-6):
    """
    åŸºäº Jacobian ä¼ªé€†çš„æ•°å€¼ IK
    
    Args:
        target_pose: ç›®æ ‡ä½å§¿ (4x4 å˜æ¢çŸ©é˜µ)
        q_init: åˆå§‹å…³èŠ‚è§’åº¦
        dh_params: DH å‚æ•°
        
    Returns:
        q: è§£å‡ºçš„å…³èŠ‚è§’åº¦
    """
    q = q_init.copy()
    
    for _ in range(max_iter):
        # å½“å‰ä½å§¿
        T_current = forward_kinematics(q, dh_params)
        
        # ä½å§¿è¯¯å·®
        pos_error = target_pose[:3, 3] - T_current[:3, 3]
        rot_error = rotation_error(T_current[:3, :3], target_pose[:3, :3])
        error = np.concatenate([pos_error, rot_error])
        
        if np.linalg.norm(error) < tol:
            return q
        
        # è®¡ç®— Jacobian
        J = compute_jacobian(q, dh_params)
        
        # ä¼ªé€†æ±‚è§£
        J_pinv = np.linalg.pinv(J)
        dq = J_pinv @ error
        
        # æ›´æ–°
        q = q + 0.5 * dq  # æ­¥é•¿ 0.5
        
        # å…³èŠ‚é™ä½
        q = np.clip(q, q_min, q_max)
    
    return q

def rotation_error(R_current, R_target):
    """è®¡ç®—æ—‹è½¬è¯¯å·® (è½´è§’å½¢å¼)"""
    R_err = R_target @ R_current.T
    axis_angle = R.from_matrix(R_err).as_rotvec()
    return axis_angle
```

### 1.3 é›…å¯æ¯”çŸ©é˜µ (Jacobian)

**å®šä¹‰**: å…³èŠ‚é€Ÿåº¦åˆ°æœ«ç«¯é€Ÿåº¦çš„æ˜ å°„ã€‚

$$
\dot{\mathbf{x}} = \mathbf{J}(\mathbf{q}) \cdot \dot{\mathbf{q}}
$$

å…¶ä¸­ $\dot{\mathbf{x}} = [v_x, v_y, v_z, \omega_x, \omega_y, \omega_z]^T$

**åº”ç”¨**:
- **é€Ÿåº¦æ§åˆ¶**: $\dot{\mathbf{q}} = \mathbf{J}^{-1} \dot{\mathbf{x}}$
- **å¥‡å¼‚æ€§åˆ†æ**: $\det(\mathbf{J}) = 0$ æ—¶å¥‡å¼‚
- **åŠ›ä¼ é€’**: $\boldsymbol{\tau} = \mathbf{J}^T \mathbf{F}$ (æœ«ç«¯åŠ›åˆ°å…³èŠ‚åŠ›çŸ©)

---

## 2. åŠ¨åŠ›å­¦ (Dynamics)

### 2.1 åŠ¨åŠ›å­¦æ–¹ç¨‹

**æ‹‰æ ¼æœ—æ—¥æ–¹ç¨‹**:

$$
\mathbf{M}(\mathbf{q})\ddot{\mathbf{q}} + \mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})\dot{\mathbf{q}} + \mathbf{g}(\mathbf{q}) = \boldsymbol{\tau}
$$

- $\mathbf{M}(\mathbf{q})$: æƒ¯æ€§çŸ©é˜µ (Mass Matrix)
- $\mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})$: ç§‘æ°åŠ›/ç¦»å¿ƒåŠ›çŸ©é˜µ
- $\mathbf{g}(\mathbf{q})$: é‡åŠ›å‘é‡
- $\boldsymbol{\tau}$: å…³èŠ‚åŠ›çŸ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åŠ¨åŠ›å­¦å»ºæ¨¡æ–¹æ³•                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   è§£æå»ºæ¨¡ (åŸºäºæ¨¡å‹):                                                      â”‚
â”‚   â€¢ ç‰›é¡¿-æ¬§æ‹‰æ³• (Newton-Euler): é€’å½’è®¡ç®—ï¼Œé«˜æ•ˆ                              â”‚
â”‚   â€¢ æ‹‰æ ¼æœ—æ—¥æ³• (Lagrangian): èƒ½é‡æ–¹æ³•ï¼Œç›´è§‚                                 â”‚
â”‚   â€¢ éœ€è¦ç²¾ç¡®çš„æƒ¯æ€§å‚æ•° (è´¨é‡ã€æƒ¯é‡ã€è´¨å¿ƒä½ç½®)                                â”‚
â”‚                                                                             â”‚
â”‚   æ•°æ®é©±åŠ¨ (å­¦ä¹ å‹):                                                        â”‚
â”‚   â€¢ ç¥ç»ç½‘ç»œæ‹Ÿåˆ: è¾“å…¥ (q, qÌ‡, qÌˆ) â†’ è¾“å‡º Ï„                                   â”‚
â”‚   â€¢ Gaussian Process: ä¸ç¡®å®šæ€§ä¼°è®¡                                         â”‚
â”‚   â€¢ é€‚åˆéš¾ä»¥ç²¾ç¡®å»ºæ¨¡çš„åœºæ™¯ (æŸ”æ€§ã€æ‘©æ“¦)                                     â”‚
â”‚                                                                             â”‚
â”‚   å¸¸ç”¨åº“:                                                                   â”‚
â”‚   â€¢ Pinocchio: C++/Python, é«˜æ•ˆåŠ¨åŠ›å­¦è®¡ç®—                                  â”‚
â”‚   â€¢ PyBullet: ä»¿çœŸå†…ç½®                                                     â”‚
â”‚   â€¢ Drake: å¤šä½“åŠ¨åŠ›å­¦                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åŠ¨åŠ›å­¦åº“ä½¿ç”¨ (Pinocchio)

```python
import pinocchio as pin
import numpy as np

# åŠ è½½æœºå™¨äººæ¨¡å‹
model = pin.buildModelFromUrdf("panda.urdf")
data = model.createData()

# å½“å‰çŠ¶æ€
q = np.array([0, -np.pi/4, 0, -3*np.pi/4, 0, np.pi/2, np.pi/4])
dq = np.zeros(7)
ddq = np.zeros(7)

# æ­£è¿åŠ¨å­¦
pin.forwardKinematics(model, data, q)
ee_pose = data.oMi[-1]  # æœ«ç«¯ä½å§¿

# åŠ¨åŠ›å­¦è®¡ç®—
# æƒ¯æ€§çŸ©é˜µ M(q)
M = pin.crba(model, data, q)

# ç§‘æ°åŠ› + ç¦»å¿ƒåŠ› C(q, dq) * dq
C_dq = pin.nle(model, data, q, dq) - pin.computeGeneralizedGravity(model, data, q)

# é‡åŠ› g(q)
g = pin.computeGeneralizedGravity(model, data, q)

# é€†åŠ¨åŠ›å­¦: Ï„ = M * ddq + C * dq + g
tau = pin.rnea(model, data, q, dq, ddq)

# æ­£åŠ¨åŠ›å­¦: ddq = M^(-1) * (Ï„ - C * dq - g)
ddq = pin.aba(model, data, q, dq, tau)

# Jacobian
J = pin.computeFrameJacobian(model, data, q, frame_id, pin.ReferenceFrame.LOCAL_WORLD_ALIGNED)
```

---

## 3. æ§åˆ¶æ–¹æ³• (Control Methods)

### 3.1 PID æ§åˆ¶

**æœ€åŸºç¡€çš„å…³èŠ‚ç©ºé—´æ§åˆ¶**:

$$
\tau = K_p (q_d - q) + K_d (\dot{q}_d - \dot{q}) + K_i \int (q_d - q) dt
$$

```python
class PIDController:
    """å•å…³èŠ‚ PID æ§åˆ¶å™¨"""
    def __init__(self, kp, ki, kd, dt=0.001):
        self.kp = kp
        self.ki = ki
        self.kd = kd
        self.dt = dt
        self.integral = 0
        self.prev_error = 0
    
    def compute(self, q_desired, q_current, dq_current=None):
        """
        è®¡ç®—æ§åˆ¶åŠ›çŸ©
        
        Args:
            q_desired: ç›®æ ‡ä½ç½®
            q_current: å½“å‰ä½ç½®
            dq_current: å½“å‰é€Ÿåº¦ (å¯é€‰)
        """
        error = q_desired - q_current
        
        # P é¡¹
        p_term = self.kp * error
        
        # I é¡¹
        self.integral += error * self.dt
        self.integral = np.clip(self.integral, -1, 1)  # ç§¯åˆ†é™å¹…
        i_term = self.ki * self.integral
        
        # D é¡¹
        if dq_current is not None:
            d_term = -self.kd * dq_current  # é€Ÿåº¦åé¦ˆ
        else:
            d_term = self.kd * (error - self.prev_error) / self.dt
        
        self.prev_error = error
        
        return p_term + i_term + d_term

# å¤šå…³èŠ‚ PID
class JointPIDController:
    def __init__(self, n_joints, kp, ki, kd, dt=0.001):
        self.controllers = [
            PIDController(kp[i], ki[i], kd[i], dt) 
            for i in range(n_joints)
        ]
    
    def compute(self, q_desired, q_current, dq_current):
        tau = np.zeros(len(self.controllers))
        for i, ctrl in enumerate(self.controllers):
            tau[i] = ctrl.compute(q_desired[i], q_current[i], dq_current[i])
        return tau
```

**ä¼˜ç¼ºç‚¹**:

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
| :--- | :--- |
| ç®€å•ã€æ— éœ€æ¨¡å‹ | æ— æ³•å¤„ç†éçº¿æ€§ |
| è°ƒå‚ç›´è§‚ | è€¦åˆç³»ç»Ÿæ€§èƒ½å·® |
| è®¡ç®—å¿« | æ— æ³•å¤„ç†çº¦æŸ |

### 3.2 é˜»æŠ—æ§åˆ¶ (Impedance Control)

**æ ¸å¿ƒæ€æƒ³**: è®©æœºå™¨äººè¡¨ç°å¾—åƒå¼¹ç°§-é˜»å°¼ç³»ç»Ÿã€‚

$$
\mathbf{F} = \mathbf{M}_d (\ddot{\mathbf{x}}_d - \ddot{\mathbf{x}}) + \mathbf{B}_d (\dot{\mathbf{x}}_d - \dot{\mathbf{x}}) + \mathbf{K}_d (\mathbf{x}_d - \mathbf{x})
$$

- $\mathbf{M}_d$: æœŸæœ›æƒ¯æ€§
- $\mathbf{B}_d$: æœŸæœ›é˜»å°¼
- $\mathbf{K}_d$: æœŸæœ›åˆšåº¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é˜»æŠ—æ§åˆ¶ vs å¯¼çº³æ§åˆ¶                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   é˜»æŠ—æ§åˆ¶ (Impedance Control):                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   è¾“å…¥: ä½ç½®è¯¯å·® Î”x                                                 â”‚   â”‚
â”‚   â”‚   è¾“å‡º: åŠ› F                                                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   F = K * Î”x + B * Î”áº‹                                               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   é€‚ç”¨: ä½ç½®æ§åˆ¶å‹æœºå™¨äºº + åŠ›ä¼ æ„Ÿå™¨                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   å¯¼çº³æ§åˆ¶ (Admittance Control):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   è¾“å…¥: å¤–åŠ› F (åŠ›ä¼ æ„Ÿå™¨æµ‹é‡)                                       â”‚   â”‚
â”‚   â”‚   è¾“å‡º: ä½ç½®ä¿®æ­£ Î”x                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Î”x = (1/K) * F + (1/B) * âˆ«F dt                                    â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   é€‚ç”¨: çº¯ä½ç½®æ§åˆ¶æœºå™¨äºº (æ— åŠ›çŸ©æ¥å£)                               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   ğŸ’¡ é€‰æ‹©åŸåˆ™:                                                              â”‚
â”‚   â€¢ èƒ½ç›´æ¥æ§åˆ¶åŠ›/åŠ›çŸ© â†’ é˜»æŠ—æ§åˆ¶                                           â”‚
â”‚   â€¢ åªèƒ½æ§åˆ¶ä½ç½® â†’ å¯¼çº³æ§åˆ¶                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é˜»æŠ—æ§åˆ¶å™¨å®ç°**:

```python
class ImpedanceController:
    """ç¬›å¡å°”ç©ºé—´é˜»æŠ—æ§åˆ¶"""
    def __init__(self, K, B, M=None):
        """
        Args:
            K: åˆšåº¦çŸ©é˜µ (6x6)
            B: é˜»å°¼çŸ©é˜µ (6x6)
            M: æƒ¯æ€§çŸ©é˜µ (6x6), å¯é€‰
        """
        self.K = np.diag(K) if len(K.shape) == 1 else K
        self.B = np.diag(B) if len(B.shape) == 1 else B
        self.M = np.diag(M) if M is not None and len(M.shape) == 1 else M
        
    def compute(self, x_current, x_desired, dx_current, dx_desired, ddx_desired=None):
        """
        è®¡ç®—æœŸæœ›çš„æœ«ç«¯åŠ›
        
        Args:
            x_current: å½“å‰æœ«ç«¯ä½å§¿ (6,) [pos, ori]
            x_desired: ç›®æ ‡æœ«ç«¯ä½å§¿ (6,)
            dx_current: å½“å‰æœ«ç«¯é€Ÿåº¦ (6,)
            dx_desired: ç›®æ ‡æœ«ç«¯é€Ÿåº¦ (6,)
            
        Returns:
            F: æœŸæœ›æœ«ç«¯åŠ› (6,)
        """
        # ä½ç½®è¯¯å·®
        pos_error = x_desired[:3] - x_current[:3]
        vel_error = dx_desired[:3] - dx_current[:3]
        
        # å§¿æ€è¯¯å·® (éœ€è¦ç‰¹æ®Šå¤„ç†)
        ori_error = orientation_error(x_current[3:], x_desired[3:])
        omega_error = dx_desired[3:] - dx_current[3:]
        
        error = np.concatenate([pos_error, ori_error])
        derror = np.concatenate([vel_error, omega_error])
        
        # é˜»æŠ—æ–¹ç¨‹
        F = self.K @ error + self.B @ derror
        
        if self.M is not None and ddx_desired is not None:
            F += self.M @ ddx_desired
            
        return F
    
    def to_joint_torque(self, F, J):
        """è½¬æ¢ä¸ºå…³èŠ‚åŠ›çŸ©"""
        return J.T @ F

# ä½¿ç”¨ç¤ºä¾‹
impedance = ImpedanceController(
    K=[1000, 1000, 1000, 50, 50, 50],  # å¹³ç§»åˆšåº¦é«˜ï¼Œæ—‹è½¬åˆšåº¦ä½
    B=[100, 100, 100, 10, 10, 10],
)

F_desired = impedance.compute(x_current, x_desired, dx_current, dx_desired)
tau = impedance.to_joint_torque(F_desired, J)
```

**VLA ä¸­çš„åº”ç”¨**:
- **æ¥è§¦ä»»åŠ¡**: æŠ“å–æ—¶åˆ‡æ¢åˆ°ä½åˆšåº¦ï¼Œç¡®ä¿æŸ”é¡º
- **äººæœºåä½œ**: ç¢°åˆ°äººæ—¶è¡¨ç°æŸ”è½¯
- **è£…é…ä»»åŠ¡**: æ’å…¥æ—¶éœ€è¦æŸ”é¡º

### 3.3 MPC (Model Predictive Control)

**æ ¸å¿ƒæ€æƒ³**: åœ¨çº¿æ»šåŠ¨ä¼˜åŒ–ï¼Œé¢„æµ‹æœªæ¥è½¨è¿¹å¹¶ä¼˜åŒ–ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MPC å·¥ä½œåŸç†                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   æ—¶é—´è½´:                                                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º       â”‚
â”‚   t    t+1   t+2   ...   t+N (é¢„æµ‹horizon)                                  â”‚
â”‚   â”‚     â”‚     â”‚           â”‚                                                 â”‚
â”‚   â–¼     â–¼     â–¼           â–¼                                                 â”‚
â”‚   xâ‚€    xâ‚    xâ‚‚    ...   xâ‚™   (çŠ¶æ€é¢„æµ‹)                                   â”‚
â”‚         uâ‚€    uâ‚    ...   uâ‚™â‚‹â‚ (æ§åˆ¶è¾“å…¥)                                   â”‚
â”‚                                                                             â”‚
â”‚   ä¼˜åŒ–é—®é¢˜:                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   min  Î£ ||x_k - x_ref||Â²_Q + ||u_k||Â²_R                            â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   s.t. x_{k+1} = f(x_k, u_k)    (åŠ¨åŠ›å­¦çº¦æŸ)                        â”‚   â”‚
â”‚   â”‚        x_min â‰¤ x_k â‰¤ x_max      (çŠ¶æ€çº¦æŸ)                          â”‚   â”‚
â”‚   â”‚        u_min â‰¤ u_k â‰¤ u_max      (è¾“å…¥çº¦æŸ)                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   æ»šåŠ¨æ‰§è¡Œ:                                                                  â”‚
â”‚   1. åœ¨ t æ—¶åˆ»æ±‚è§£ä¼˜åŒ–é—®é¢˜ï¼Œå¾—åˆ° uâ‚€, uâ‚, ..., uâ‚™â‚‹â‚                         â”‚
â”‚   2. åªæ‰§è¡Œ uâ‚€                                                              â”‚
â”‚   3. åœ¨ t+1 æ—¶åˆ»é‡æ–°æ±‚è§£                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**MPC å®ç° (ä½¿ç”¨ CVXPY)**:

```python
import cvxpy as cp
import numpy as np

class LinearMPC:
    """çº¿æ€§ MPC æ§åˆ¶å™¨"""
    def __init__(self, A, B, Q, R, N, x_min, x_max, u_min, u_max):
        """
        Args:
            A, B: çº¿æ€§ç³»ç»ŸçŸ©é˜µ x_{k+1} = A @ x_k + B @ u_k
            Q, R: ä»£ä»·æƒé‡
            N: é¢„æµ‹ horizon
            x_min, x_max: çŠ¶æ€çº¦æŸ
            u_min, u_max: è¾“å…¥çº¦æŸ
        """
        self.A, self.B = A, B
        self.Q, self.R = Q, R
        self.N = N
        self.n_x, self.n_u = A.shape[0], B.shape[1]
        self.x_min, self.x_max = x_min, x_max
        self.u_min, self.u_max = u_min, u_max
        
    def solve(self, x0, x_ref):
        """
        æ±‚è§£ MPC ä¼˜åŒ–é—®é¢˜
        
        Args:
            x0: å½“å‰çŠ¶æ€
            x_ref: å‚è€ƒè½¨è¿¹ (N+1, n_x)
            
        Returns:
            u_opt: æœ€ä¼˜æ§åˆ¶è¾“å…¥ (ç¬¬ä¸€ä¸ª)
        """
        # å˜é‡
        x = cp.Variable((self.N + 1, self.n_x))
        u = cp.Variable((self.N, self.n_u))
        
        # ä»£ä»·å‡½æ•°
        cost = 0
        constraints = [x[0] == x0]  # åˆå§‹çŠ¶æ€çº¦æŸ
        
        for k in range(self.N):
            # çŠ¶æ€ä»£ä»·
            cost += cp.quad_form(x[k] - x_ref[k], self.Q)
            # è¾“å…¥ä»£ä»·
            cost += cp.quad_form(u[k], self.R)
            # åŠ¨åŠ›å­¦çº¦æŸ
            constraints += [x[k+1] == self.A @ x[k] + self.B @ u[k]]
            # çŠ¶æ€çº¦æŸ
            constraints += [self.x_min <= x[k], x[k] <= self.x_max]
            # è¾“å…¥çº¦æŸ
            constraints += [self.u_min <= u[k], u[k] <= self.u_max]
        
        # ç»ˆç«¯ä»£ä»·
        cost += cp.quad_form(x[self.N] - x_ref[self.N], self.Q * 10)
        
        # æ±‚è§£
        prob = cp.Problem(cp.Minimize(cost), constraints)
        prob.solve(solver=cp.OSQP, warm_start=True)
        
        return u[0].value

# ä½¿ç”¨ç¤ºä¾‹
dt = 0.01
A = np.array([[1, dt], [0, 1]])  # åŒç§¯åˆ†ç³»ç»Ÿ
B = np.array([[0.5*dt**2], [dt]])
Q = np.diag([10, 1])
R = np.array([[0.1]])

mpc = LinearMPC(A, B, Q, R, N=20, 
                x_min=np.array([-10, -5]), x_max=np.array([10, 5]),
                u_min=np.array([-10]), u_max=np.array([10]))

x_current = np.array([0, 0])
x_ref = np.tile([1, 0], (21, 1))  # ç›®æ ‡ä½ç½® 1
u_opt = mpc.solve(x_current, x_ref)
```

**MPC vs PID**:

| ç»´åº¦ | MPC | PID |
| :--- | :--- | :--- |
| **çº¦æŸå¤„ç†** | æ˜¾å¼å¤„ç† | æ— æ³•å¤„ç† |
| **é¢„æµ‹èƒ½åŠ›** | æœ‰ | æ—  |
| **è®¡ç®—é‡** | é«˜ (éœ€åœ¨çº¿ä¼˜åŒ–) | ä½ |
| **è°ƒå‚** | Q, R çŸ©é˜µ | Kp, Ki, Kd |
| **é€‚ç”¨** | å¤æ‚çº¦æŸã€æœ€ä¼˜æ§åˆ¶ | ç®€å•è·Ÿè¸ª |

### 3.4 æ§åˆ¶æ–¹æ³•å¯¹æ¯”æ€»ç»“

| æ–¹æ³• | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ | VLA åº”ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- | :--- |
| **PID** | è¯¯å·®åé¦ˆ | ç®€å•ã€å¿«é€Ÿ | æ— æ³•å¤„ç†è€¦åˆ/çº¦æŸ | åº•å±‚å…³èŠ‚æ§åˆ¶ |
| **é˜»æŠ—æ§åˆ¶** | å¼¹ç°§-é˜»å°¼è¡Œä¸º | æŸ”é¡ºã€å®‰å…¨ | éœ€è°ƒåˆšåº¦å‚æ•° | æ¥è§¦ä»»åŠ¡ã€äººæœºåä½œ |
| **å¯¼çº³æ§åˆ¶** | åŠ›â†’ä½ç½® | é€‚ç”¨ä½ç½®æ§åˆ¶è‡‚ | éœ€è¦åŠ›ä¼ æ„Ÿå™¨ | æ‹–åŠ¨ç¤ºæ•™ |
| **MPC** | æ»šåŠ¨ä¼˜åŒ– | å¯åŠ çº¦æŸã€æœ€ä¼˜ | è®¡ç®—é‡å¤§ | è½¨è¿¹ä¼˜åŒ–ã€é¿éšœ |
| **Computed Torque** | åŠ¨åŠ›å­¦è¡¥å¿ | è§£è€¦æ§åˆ¶ | éœ€ç²¾ç¡®æ¨¡å‹ | é«˜ç²¾åº¦ä»»åŠ¡ |

---

## 4. VLA ä¸­çš„æ§åˆ¶æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VLA æ§åˆ¶æ¶æ„                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   é«˜å±‚: VLA æ¨¡å‹ (OpenVLA, Ï€0 ç­‰)                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   è¾“å…¥: å›¾åƒ + è¯­è¨€æŒ‡ä»¤                                              â”‚   â”‚
â”‚   â”‚   è¾“å‡º: æœ«ç«¯å¢é‡ Î”pose (æˆ–ç»å¯¹ pose)                                 â”‚   â”‚
â”‚   â”‚   é¢‘ç‡: 10-30 Hz                                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚   ä¸­å±‚: è¿åŠ¨è§„åˆ’ / IK                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Î”pose â†’ è½¨è¿¹æ’å€¼ â†’ IK æ±‚è§£ â†’ å…³èŠ‚ç›®æ ‡ q_target                     â”‚   â”‚
â”‚   â”‚   å¯é€‰: MPC ä¼˜åŒ–è½¨è¿¹ã€é¿éšœ                                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚   åº•å±‚: å…³èŠ‚æ§åˆ¶ (é©±åŠ¨å™¨å†…ç½®)                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   q_target â†’ PID / é˜»æŠ—æ§åˆ¶ â†’ Ï„ â†’ ç”µæœº                              â”‚   â”‚
â”‚   â”‚   é¢‘ç‡: 1000 Hz (ç¡¬å®æ—¶)                                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   ğŸ’¡ VLA ä¸»è¦è´Ÿè´£é«˜å±‚å†³ç­–ï¼Œåº•å±‚æ§åˆ¶ç”±ä¼ ç»Ÿæ–¹æ³•ä¿è¯å®‰å…¨å’Œç²¾åº¦                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. é¢è¯• Q&A

### Q1: æ­£è¿åŠ¨å­¦å’Œé€†è¿åŠ¨å­¦çš„åŒºåˆ«ï¼Ÿ

| ç»´åº¦ | æ­£è¿åŠ¨å­¦ (FK) | é€†è¿åŠ¨å­¦ (IK) |
| :--- | :--- | :--- |
| **è¾“å…¥** | å…³èŠ‚è§’åº¦ $\mathbf{q}$ | æœ«ç«¯ä½å§¿ $\mathbf{T}$ |
| **è¾“å‡º** | æœ«ç«¯ä½å§¿ $\mathbf{T}$ | å…³èŠ‚è§’åº¦ $\mathbf{q}$ |
| **è§£çš„æ•°é‡** | å”¯ä¸€è§£ | å¯èƒ½å¤šè§£æˆ–æ— è§£ |
| **è®¡ç®—å¤æ‚åº¦** | ä½ (çŸ©é˜µä¹˜æ³•) | é«˜ (ä¼˜åŒ–/è¿­ä»£) |
| **éš¾åº¦** | ç®€å• | å¤æ‚ |

### Q2: PID å’Œ MPC çš„é€‚ç”¨åœºæ™¯ï¼Ÿ

- **PID**: ç®€å•å…³èŠ‚ä¼ºæœã€ä½å»¶è¿Ÿè¦æ±‚ã€å•è¾“å…¥å•è¾“å‡º
- **MPC**: éœ€è¦å¤„ç†çº¦æŸ (å…³èŠ‚é™ä½ã€é€Ÿåº¦é™åˆ¶)ã€éœ€è¦é¢„æµ‹ (é¿éšœ)ã€å¤šç›®æ ‡ä¼˜åŒ–

### Q3: é˜»æŠ—æ§åˆ¶çš„åˆšåº¦å‚æ•°å¦‚ä½•é€‰æ‹©ï¼Ÿ

- **é«˜åˆšåº¦ (K å¤§)**: ç²¾ç¡®ä½ç½®è·Ÿè¸ªï¼Œé€‚åˆè‡ªç”±ç©ºé—´è¿åŠ¨
- **ä½åˆšåº¦ (K å°)**: æŸ”é¡ºè¡Œä¸ºï¼Œé€‚åˆæ¥è§¦ä»»åŠ¡ã€è£…é…
- **åŠ¨æ€åˆ‡æ¢**: VLA æŠ“å–æµç¨‹ä¸­ï¼Œæ¥è¿‘é˜¶æ®µé«˜åˆšåº¦ï¼Œæ¥è§¦åä½åˆšåº¦

### Q4: ä¸ºä»€ä¹ˆ VLA åº•å±‚ä¸ç”¨ RL æ§åˆ¶ï¼Ÿ

1. **å®‰å…¨æ€§**: ä¼ ç»Ÿæ§åˆ¶ç¨³å®šæ€§æœ‰ä¿è¯ï¼ŒRL å¯èƒ½å‡ºç°æ„å¤–åŠ¨ä½œ
2. **é¢‘ç‡**: åº•å±‚æ§åˆ¶éœ€è¦ 1kHzï¼ŒRL æ¨ç†å¤ªæ…¢
3. **åˆ†å·¥**: VLA è´Ÿè´£é«˜å±‚å†³ç­– (ä»€ä¹ˆåŠ¨ä½œ)ï¼Œåº•å±‚æ§åˆ¶è´Ÿè´£ç²¾ç¡®æ‰§è¡Œ (æ€ä¹ˆæ‰§è¡Œ)

### Q5: åŠ¨åŠ›å­¦æ¨¡å‹åœ¨ VLA ä¸­çš„ä½œç”¨ï¼Ÿ

- **ä»¿çœŸè®­ç»ƒ**: Sim-to-Real éœ€è¦å‡†ç¡®çš„åŠ¨åŠ›å­¦ä»¿çœŸ
- **é‡åŠ›è¡¥å¿**: è®¡ç®— $\mathbf{g}(\mathbf{q})$ è¡¥å¿é‡åŠ›
- **åŠ›ä¼°è®¡**: æ— åŠ›ä¼ æ„Ÿå™¨æ—¶ï¼Œé€šè¿‡åŠ¨åŠ›å­¦ä¼°è®¡å¤–åŠ›
- **Computed Torque**: é«˜ç²¾åº¦è½¨è¿¹è·Ÿè¸ª

---

## ğŸ“š æ¨èèµ„æº

### ä¹¦ç±
- **[Modern Robotics](http://hades.mech.northwestern.edu/index.php/Modern_Robotics)**: è¿åŠ¨å­¦/åŠ¨åŠ›å­¦ç»å…¸æ•™æ
- **[Robotics: Modelling, Planning and Control](https://link.springer.com/book/10.1007/978-1-84628-642-1)**: Siciliano çš„æ§åˆ¶åœ£ç»

### ä»£ç åº“
- **[Pinocchio](https://github.com/stack-of-tasks/pinocchio)**: é«˜æ•ˆåŠ¨åŠ›å­¦è®¡ç®—
- **[Drake](https://github.com/RobotLocomotion/drake)**: å¤šä½“åŠ¨åŠ›å­¦
- **[PyBullet](https://pybullet.org/)**: ä»¿çœŸ + IK

### è¯¾ç¨‹
- **[Stanford CS223A](https://cs.stanford.edu/groups/manips/teaching/cs223a/)**: Introduction to Robotics
- **[ETH Robot Dynamics](https://rsl.ethz.ch/education-students/lectures.html)**: åŠ¨åŠ›å­¦ä¸æ§åˆ¶

---

[â† Back to Theory Index](./README.md)

