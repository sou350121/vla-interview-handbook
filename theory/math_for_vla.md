# VLA 数学必备：从直觉到实作（Math for VLA Implementers）

> **目标**：这不是数学系教材，而是“为了能看懂论文、写出 loss、调好机器人”的最小实践清单。按照从“基础工具”到“空间表示”再到“闭环控制”的逻辑重新梳理。

---

## 1. 基础工具箱：数学的通用语言

### 1.1 线性代数：特征与空间
- **内积与相似度（Dot Product）**：
  - **公式**：$\text{sim}(A, B) = A \cdot B = \sum A_i B_i = \|A\| \|B\| \cos(\theta)$
  - **变量定义**：`A, B` 特征向量；`theta` 夹角。
  - **公式大白话**：**给定**两个特征，**翻译**为把对应项相乘相加，结果大说明它们方向一致，“长得像”。
- **矩阵乘法（Linear Layer）**：
  - **公式**：$y = Wx + b$
  - **变量定义**：`x` 输入；`W` 权重矩阵（语义投影仪）；`y` 输出。
  - **公式大白话**：**给定**特征 `x`，**翻译**为通过权重 `W` 重新组合，把信息从“视觉空间”搬到“动作空间”。
- **低秩分解（LoRA）**：
  - **公式**：$\Delta W = A \cdot B, \quad A \in \mathbb{R}^{d \times r}, B \in \mathbb{R}^{r \times k}$
  - **变量定义**：`r` 为秩（极窄的通道）。
  - **公式大白话**：**给定**巨大变动 `ΔW`，**翻译**为拆成两个窄矩阵相乘，只学最核心的变化，省显存。
- **特征值与奇异值（Eigen / SVD）**：
  - **公式**：$Av = \lambda v, \quad A = U \Sigma V^\top$
  - **变量定义**：`v` 特征向量（骨干方向）；`Σ` 奇异值（特征强度）。
  - **公式大白话**：**给定**杂乱矩阵，**翻译**为拆出最重要的几个方向。扔掉小的奇异值，就是去噪和压缩。
- **范数与正交投影（Norms & Projection）**：
  - **公式**：$\|x\|_2 = \sqrt{\sum x_i^2}, \quad \text{proj}_d(x) = \frac{x \cdot d}{\|d\|^2} d$
  - **变量定义**：`x` 原始向量；`d` 目标方向。
  - **公式大白话**：**给定**一个动作意图，**翻译**为看它在安全方向 `d` 上的影子。把影子以外的部分切掉，就是安全过滤。

### 1.2 微积分与优化：学习的动力
- **链式法则（Chain Rule）**：
  - **公式**：$\frac{\partial \mathcal{L}}{\partial x} = \frac{\partial \mathcal{L}}{\partial y} \cdot \frac{\partial y}{\partial x}$
  - **公式大白话**：**给定**最终错误 `L`，**翻译**为一级级往回追究责任，算出每个参数对错误的贡献。
- **雅可比矩阵（Jacobian）**：
  - **公式**：$J(q) = \frac{\partial f(q)}{\partial q}, \quad \dot{x} = J(q) \dot{q}$
  - **变量定义**：`q` 关节角；`x` 末端位置。
  - **公式大白话**：**给定**关节转速，**翻译**为末端手指在空间里的漂移速度。是关节到空间的“换算率”。
- **梯度场与海森矩阵（Gradient Field & Hessian）**：
  - **公式**：$\nabla \mathcal{L}, \quad H = \nabla^2 \mathcal{L}$
  - **变量定义**：`∇L` 坡度；`H` 地形曲率。
  - **公式大白话**：**给定**当前位置，**翻译**为梯度告诉你哪最陡，海森矩阵告诉你这个陡坡是平滑的还是尖锐的（决定步长稳不稳）。

---

## 2. 空间与表示：描述物理世界

### 2.1 几何变换与旋转
- **齐次变换（SE(3)）**：
  - **公式**：$T = \begin{bmatrix} R & t \\ 0 & 1 \end{bmatrix}, \quad P_A = T_{AB} P_B$
  - **变量定义**：`R` 旋转；`t` 平移。
  - **公式大白话**：**给定**相机里的坐标，**翻译**为通过变换矩阵 `T` 变成机械臂基座能懂的坐标。
- **6D 旋转表示**：
  - **公式大白话**：**给定**一个旋转。**翻译**为不要用会“死锁”的欧拉角，用连续平滑的 6 个数（6D 旋转），让神经网络学起来不卡顿。

### 2.2 动作视角（Action Perspective）
- **关节空间（Joint-space） vs 任务空间（Task-space）**：
  - **公式大白话**：**给定**任务。**翻译**为要么直接控电机（关节），要么控手指去哪（任务空间）。VLA 通常预测任务空间的位姿增量 `Δx`。

### 2.3 状态估计（State Estimation）
- **卡尔曼滤波（Kalman Filter）**：
  - **公式**：$\hat{x}_k = \hat{x}_k^- + K_k (z_k - H \hat{x}_k^-)$
  - **变量定义**：`K` 增益（权衡大师）。
  - **公式大白话**：**给定**自己的预测和传感器的测量，**翻译**为谁准听谁的，在两者之间取个最稳的中间值。
- **指数移动平均（EMA）**：
  - **公式大白话**：**给定**一串抖动数据，**翻译**为给过去留点面子，别全信这一次。数据变动就会变顺滑。

---

## 3. 概率与信息论：理解不确定性

### 3.1 条件概率与贝叶斯
- **公式**：$P(a | s, g) = \frac{P(s, g | a) P(a)}{P(s, g)}$
- **物理意义**：VLA 的本质。**给定**画面 `s` 和目标 `g`，**翻译**为寻找最该做的动作 `a` 的可能性。

### 3.2 信息熵（Entropy）
- **公式**：$H(X) = - \sum P(x_i) \log P(x_i)$
- **公式大白话**：**给定**一个选择分佈。**翻译**为如果熵很大说明模型很迷茫（乱猜）；如果熵很小说明它非常有把握。

---

## 4. 深度学习核心：大模型的大脑

### 4.1 Transformer 内部数学
- **缩放点积注意力（Attention）**：
  - **公式**：$\text{Attn} = \text{softmax}(\frac{QK^\top}{\sqrt{d_k}}) V$
  - **公式大白话**：**给定**指令 `Q` 和图像 `K`，**翻译**为在图像里到处找匹配，把匹配到的精华信息 `V` 抓出来。

### 4.2 损失函数基础
- **负对数似然（NLL）与交叉熵**：
  - **公式**：$\mathcal{L} = -\log P(a|s,g)$
  - **公式大白话**：**给定**专家动作，**翻译**为计算模型猜对它的概率。猜得越准（概率大），Loss 越小。

### 4.3 生成模型进阶
- **重参数化技巧（Reparameterization）**：
  - **公式**：$z = \mu + \sigma \odot \epsilon$
  - **公式大白话**：**给定**预测的分布，**翻译**为把不可导的“随机抽样”变成可导的“平移缩放”，让误差能传回 `μ` 和 `σ`。
- **扩散模型与流匹配（Diffusion & Flow Matching）**：
  - **公式**：$x_t = \sqrt{\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}_t} \epsilon, \quad v_t = x_1 - x_0$
  - **公式大白话**：**给定**目标 `x0`，**翻译**为扩散是把动作弄模糊再学着复原；流匹配是直接在噪声和动作间拉一条直线，学着沿直线跑。

---

## 5. 闭环交互：策略与控制

### 5.1 强化学习深层数学
- **贝尔曼方程（Bellman Equation）**：
  - **公式**：$V(s) = \max [ R + \gamma V(s') ]$
  - **公式大白话**：**给定**现在，**翻译**为现在的价值等于现在的甜头加上对未来的指望。
- **策略梯度（Policy Gradient）**：
  - **公式**：$\nabla J \approx \mathbb{E} [ \nabla \log \pi \cdot A ]$
  - **公式大白话**：**给定**一次尝试。**翻译**为如果结果比平均好（A > 0），就给这次的动作概率加仓；搞砸了就减仓。

### 5.2 机器人控制与平滑
- **PD 控制（Proportional-Derivative）**：
  - **公式**：$u = K_p e + K_d \dot{e}$
  - **公式大白话**：**给定**距离目标的误差，**翻译**为远了就使劲追（Kp），快到了就赶紧踩刹车（Kd 阻尼）。
- **动作平滑损失（Action Smoothness）**：
  - **公式大白话**：**给定**连续动作。**翻译**为惩罚突变和剧烈加速，让机器人动起来像丝绸一样顺。

---

## 6. 工程实践：稳定训练的微操

### 6.1 梯度微操（Clipping）
- **梯度裁剪**：
  - **公式大白话**：**给定**超大梯度，**翻译**为如果力气太大（超过阈值）就等比例缩减，防止模型权重直接被“踢飞”。

### 6.2 优化器（Adam）
- **一阶与二阶动量**：
  - **公式大白话**：**给定**坡度，**翻译**为参考之前的速度（惯性）和路面颠簸程度（波动），自动调整每一步走多远。

### 6.3 采样策略（Temperature Scaling）
- **温度采样**：
  - **公式大白话**：**给定**分数。**翻译**为温度低时只选最高分（保守）；温度高时雨露均沾（随机/有创造力）。

---

## 📅 实践者 2 周速成清单（新逻辑版）

- [ ] **Day 1-2：数学地基**。手推一次 LoRA 的参数节省量，理清 Jacobian 矩阵的几何意义。
- [ ] **Day 3-4：空间感知**。实现 SE(3) 坐标变换函数，写出 6D 旋转到旋转矩阵的转换代码。
- [ ] **Day 5-6：理解不确定性**。推导 MSE Loss 与高斯分布 NLL 的等价性，理解 Entropy 对探索的意义。
- [ ] **Day 7-8：大模型大脑**。手绘 Attention 的 QKV 匹配过程，实现一个带重参数化的 VAE 采样层。
- [ ] **Day 9-10：生成模型进阶**。对比 Diffusion 和 Flow Matching 的代码实现，理清前向加噪过程。
- [ ] **Day 11-12：闭环与控制**。理解 PPO 裁剪公式的逻辑，写一个带 Kd 阻尼的 PD 控制器模拟。
- [ ] **Day 13-14：系统联调**。在一个训练循环中加入梯度裁剪、EMA 平滑和动作平滑项，观察训练曲线。

---

[← 返回理论首页](./README.md)
